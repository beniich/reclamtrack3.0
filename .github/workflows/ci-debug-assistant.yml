name: CI – Debug Assistant

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    backend:
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: ./backend
        steps:
            - uses: actions/checkout@v4

            - name: Set up Python 3.12
              uses: actions/setup-python@v5
              with:
                  python-version: "3.12"

            - name: Install Poetry
              run: |
                  curl -sSL https://install.python-poetry.org | python3 -
                  echo "$HOME/.local/bin" >> $GITHUB_PATH

            - name: Install dependencies
              run: poetry install --no-interaction --no-ansi

            - name: Lint (ruff)
              run: poetry run ruff check .

            - name: Run tests & coverage
              run: poetry run pytest -q --cov=app --cov-report=term-missing

    frontend:
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: ./frontend
        steps:
            - uses: actions/checkout@v4

            - name: Set up Node
              uses: actions/setup-node@v4
              with:
                  node-version: "20"

            - name: Install deps
              run: npm ci

            - name: Build (Vite) – vérifier que le bundling passe
              run: npm run build
